<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>刮刮乐</title>
    <script src="js/fontSize_p.js"></script>
    <link rel="stylesheet" href="./css/swiper.min.css">
    <script src="./js/jquery.1.11.1.min.js"></script>
    <script src="./js/swiper.min.js"></script>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/animate.css">
</head>
<body>
<img src="./images/cover.png" alt="" id="imgCover" style="display: none;">
    <div class="wrap">
        <div class="rule_btn"></div>
        <a class="myprize_btn" href="./myPrize.html"></a>
        <div class="head">
            <div class="can_container">
                <div id="can_con">
                    <div class="animated tada infinite btn-shake">开始刮奖</div>
                    <canvas id="can"></canvas>
                </div>
            </div>
        </div>
        <!--滑动红包-->
        <div class="swiper-tit"></div>
        <div class="swiper-container hongbao_list">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <p ><img src="./images/hongbao.png" alt=""></p>
                    <p>300元红包</p>
                </div>
                <div class="swiper-slide"><p><img src="./images/hongbao.png" alt=""></p>
                    <p>300元红包</p></div>
                <div class="swiper-slide"><p><img src="./images/hongbao.png" alt=""></p>
                    <p>300元红包</p></div>
                <div class="swiper-slide"><p><img src="./images/hongbao.png" alt=""></p>
                    <p>300元红包</p></div>
                <div class="swiper-slide"><p><img src="./images/hongbao.png" alt=""></p>
                    <p>300元红包</p></div>
            </div>
            <div class="swiper-scrollbar"></div>
        </div>
    </div>
    <div class="fixed">*奖品与活动和设备生产商Apple Inc.公司无关</div>
    <!--规则-->
    <div class="rule-model">
        <div class="wrap">
            <div class="rule-container">
                <a class="close" href="javascript:void(0);"></a>
                <div class="container">
                    <div class="text-wrap">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <p>9要发，9月财运大爆炸！这波红包包你满意，领到手抽软~</p><p>活动说明：参与活动即有机会获得幸运奖，每天8次免费抽奖机会。此活动为概率中奖，奖品数量有限，祝好运。</p><p>惊喜一：599元红包</p><p>惊喜二：299元红包</p><p>惊喜三：99元红包</p><p>惊喜四：9元红包</p><p>惊喜五：幸运奖</p><p>－－－－－－－－－－－－－－－－</p><p>重要声明</p><p>1、实物类奖品将在活动结束后5-10个工作日安排发货，请耐心等待</p><p>2、优惠券类奖品的使用规则详见每个优惠券的介绍页</p><p>3、请兑换后仔细阅读使用流程，如有疑问，可直接联系客服专线：400-080-6659或客服QQ：4000806659（工作日9:00至18:00）</p><p>4、通过非法途径获得奖品的，主办方有权不提供奖品</p>
                                <div class="nav"><span>更多概率说明</span><i></i></div>
                                <div class="text">
                                    <div class="probability-wrapper rule-3">
                                        <div class="probability-scroller"><ul><li>599元红包共3份，中奖概率0.01%</li><li>299元红包共6份，中奖概率0.02%</li><li>99元红包共20份，中奖概率0.06%</li><li>9元红包共100份，中奖概率0.3%</li></ul></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-scrollbar"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--
    红包弹出层
    -->
    <div class="hongbao_model">
        <!--swiper1-->
        <div class="hongbao_model_container">
            <div class="hongbao_swiper">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img class="head_img" src="./images/hongbao_model_img.jpg" alt="">
                        <p class="sum">299红包</p>
                        <div class="tit">【商品详情】</div>
                        <p class="des">商品名称：599元支付宝红包</p>
                        <div class="tit">【领取说明】</div>
                        <p class="des">获奖后，请详细填写个人手机号（将作为支付宝充值号码）、姓名（核对用户），我们会在5-10个工作日内为您充值，若因个人原因导致号码错误、误充错充，不会进行补充，敬请谅解</p>
                        <div class="tit">【特别说明】</div>
                        <p class="des"> 请仔细阅读领奖流程，若有疑问，可直接联系客服专线：400-080-6659或客服QQ：4000806659（工作日9:00至18:00）</p>
                    </div>
                </div>
                <div class="swiper-scrollbar1"></div>
            </div>

        </div>
        <div class="close">收起</div>
    </div>
<!--奖品弹出层-->
<div class="model model_prize">
    <div class="wrap" style="transform:scale(.1)">
        <div class="light">
        </div>
        <div class="close"></div>
        <div class="hb-template">
            <div class="back"></div>
            <div class="body">
                <!--奖品图片-->
                <img src="" alt="">
            </div>
            <div class="front">
                <p class="p1">恭喜获得</p>
                <p class="prize">888</p>
                <a href="javascript:void(0);" class="btn">立即领取</a>
            </div>
        </div>
    </div>
</div>
    <script src="./js/index.js"></script>
<script>
    /*canvas*/
    var canCon = document.getElementById('can_con');
    var oCan = document.getElementById('can');//获取画布
      var i = Math.round(Math.random()*3);//获取0-3的随机整数
    canCon.style.background = 'url(./images/'+i+'.jpg) no-repeat center';
    var oGc = oCan.getContext('2d');
    /* 画布偏移量，下面用到的时候再介绍*/
    var arr = getOffset(oCan);
    var oLeft = arr[0];
    var oTop = arr[1];
    //创建图片对象
    var img = new Image();
     img.src = './images/cover.png';
    /*var img = document.getElementsByTagName('imgCover');*/
    //创建一个图案对象
    var pat=oGc.createPattern(img,"repeat");
    oGc.beginPath();
    oGc.fillStyle = pat;
    oGc.fillRect(0,0,300,200);
    oGc.closePath();
    /* 增加触摸监听*/
    oCan.addEventListener("touchstart",fn1,false);
    function fn1(){
        if($('.btn-shake').css('display') === 'none'){
            /* 初始化画笔*/
            oGc.beginPath();
            /* 画笔粗细*/
            oGc.lineCap = 'round';
            oGc.lineWidth = 30;
            oGc.lineJoin = 'round';
            /* 设置组合效果*/
            oGc.globalCompositeOperation = 'destination-out';
            /* 移动画笔原点*/
            oGc.moveTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop);
            document.addEventListener("touchmove",fn2);
            document.addEventListener('touchend',fn3);
        }

    };
    function fn2(){
        /* 根据手指移动画线，使之变透明*/
        console.log(222);
        oGc.lineTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop);
        /* 填充*/
        oGc.stroke();
    }
    function fn3() {
        oGc.clearRect(0,0,oCan.width,oCan.height);
        $('.model_prize .body img').attr('src','./images/'+1+'.jpg');
        $('.model_prize .front .prize').html('yidengjiang');
        $('.model_prize .close').click(function(){
            $('.model_prize').hide();
        });
        $('.model_prize').show();
        var num = 0.1;
        var timer = setInterval(function () {
            num+=0.01;
            if (num >= 1){
                clearInterval(timer);
                $('.model_prize .light').show();
            }
            $('.model_prize .wrap')[0].style.transform = "scale("+num+")";
        },3);
        document.removeEventListener('touchstart',fn1);
        document.removeEventListener('touchmove',fn2);
        document.removeEventListener('touchend',fn3);
    }

    /* 之所以会用到下面的那个函数getOffset（obj）
     * 是因为event.touches[0].pageX、pageY获取的是相对于可视窗口的距离
     * 而lineTo画笔的定位是根据画布位置定位的
     * 所以就要先获取到画布(canvas)相对于可视窗口的距离，然后计算得出触摸点相对于画布的距离
     * */
    /* 获取该元素到可视窗口的距离*/
    function getOffset(obj){
        var valLeft = 0,valTop = 0;
        function get(obj){
            valLeft += obj.offsetLeft;
            valTop += obj.offsetTop;
            /* 不到最外层就一直调用，直到offsetParent为body*/
            if (obj.offsetParent.tagName!='BODY') {
                get(obj.offsetParent);
            }
            return [valLeft,valTop];
        }
        return get(obj);
    }

</script>
</body>
</html>